import{_ as O,r as p,i as P,B as J,b as W,c as d,e as a,f as U,t as f,w as x,p as K,j as w,l as s,v as c,m as h,C as D,F as _,g as S,k as Q,D as X,u as Y,o as u,q,E as Z,G as ee,H as ae}from"./index-BCsOHuRH.js";const te={class:"propiedad-form"},oe={class:"page-header"},ie={class:"form-section"},le={class:"form-group"},se={class:"form-group"},re={class:"form-row"},ne={class:"form-group"},de={class:"form-group"},ue={class:"form-group"},pe={class:"form-group"},ce={class:"form-group"},me={class:"map-container"},ve={key:0,class:"coordinates-info"},fe={class:"form-section"},ge={class:"form-row"},be={class:"form-group"},ye={class:"form-group"},ke={class:"form-group"},we={class:"form-section"},Ce={class:"form-group checkbox-group"},Ve={class:"form-group checkbox-group"},Ee={class:"form-section"},Ie={key:0,class:"imagenes-grid"},Me=["src","alt"],Fe=["onClick"],Pe={key:1,class:"imagenes-grid"},Ue=["src","alt"],xe=["onClick"],he={class:"upload-area"},De={key:0,class:"error-message"},_e={class:"form-actions"},Se=["disabled"],qe={__name:"PropiedadForm",setup(Le){const E=Y(),L=J(),t=p({titulo:"",descripcion:"",tipo:"venta",divisa:"ARS",precio:0,ubicacion:"",latitud:null,longitud:null,dormitorios:0,banos:0,superficie:0,destacada:!1,activa:!0}),g=p([]),m=p([]),v=p(""),b=p(!1),I=p(!1),B=p(null),M=p(null);let r=null,C=null;const y=P(()=>L.params.id),V=P(()=>!!y.value),$=i=>`https://schweizerinmobiliaria.com/api/public/uploads/${i}`,A=async()=>{if(y.value)try{const e=(await X(y.value)).data.data;t.value={titulo:e.titulo,descripcion:e.descripcion||"",tipo:e.tipo,divisa:e.divisa||"ARS",precio:parseFloat(e.precio),ubicacion:e.ubicacion,latitud:e.latitud?parseFloat(e.latitud):null,longitud:e.longitud?parseFloat(e.longitud):null,dormitorios:parseInt(e.dormitorios),banos:parseInt(e.banos),superficie:parseFloat(e.superficie),destacada:!!e.destacada,activa:!!e.activa},g.value=e.imagenes||[],t.value.latitud&&t.value.longitud&&r&&(k(t.value.latitud,t.value.longitud),r.setView([t.value.latitud,t.value.longitud],15))}catch(i){console.error("Error al cargar propiedad:",i),v.value="Error al cargar los datos de la propiedad"}},R=async()=>{v.value="",b.value=!0;try{if(V.value)await Z(y.value,t.value),alert("Propiedad actualizada exitosamente"),E.push("/admin/propiedades");else{const e=(await ee(t.value)).data.data.id;if(m.value.length>0){I.value=!0;for(const l of m.value)try{const o=new FormData;o.append("imagen",l.file),await ae(e,o)}catch(o){console.error("Error al subir imagen:",o)}I.value=!1}alert("Propiedad creada exitosamente"),E.push("/admin/propiedades")}}catch(i){console.error("Error al guardar:",i),v.value=i.response?.data?.message||"Error al guardar la propiedad"}finally{b.value=!1}},j=i=>{Array.from(i.target.files).forEach(l=>{if(l.size>5242880){alert(`${l.name} es demasiado grande. Máximo 5MB por imagen.`);return}const o=new FileReader;o.onload=n=>{m.value.push({file:l,preview:n.target.result})},o.readAsDataURL(l)}),i.target.value=""},z=i=>{m.value.splice(i,1)},N=async(i,e)=>{if(confirm("¿Eliminar esta imagen?"))try{g.value.splice(e,1),alert("Imagen eliminada")}catch(l){console.error("Error al eliminar imagen:",l),alert("Error al eliminar la imagen")}};W(()=>{A(),T()});const T=()=>{if(!document.getElementById("leaflet-css")){const i=document.createElement("link");i.id="leaflet-css",i.rel="stylesheet",i.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(i)}if(window.L)F();else{const i=document.createElement("script");i.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",i.onload=()=>F(),document.head.appendChild(i)}},F=()=>{r=window.L.map(M.value).setView([-32.8895,-68.8458],13),window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(r),r.on("click",l=>{k(l.latlng.lat,l.latlng.lng)}),t.value.latitud&&t.value.longitud&&(k(t.value.latitud,t.value.longitud),r.setView([t.value.latitud,t.value.longitud],15))},k=(i,e)=>{C&&r.removeLayer(C),C=window.L.marker([i,e]).addTo(r),t.value.latitud=i,t.value.longitud=e},G=async()=>{if(!(t.value.ubicacion.length<5))try{const e=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t.value.ubicacion+", Mendoza, Argentina")}&limit=1`)).json();if(e&&e.length>0&&r){const l=parseFloat(e[0].lat),o=parseFloat(e[0].lon);r.setView([l,o],15),k(l,o)}}catch(i){console.error("Error al buscar dirección:",i)}};return(i,e)=>{const l=K("router-link");return u(),d("div",te,[a("div",oe,[a("h2",null,f(V.value?"Editar Propiedad":"Nueva Propiedad"),1),U(l,{to:"/admin/propiedades",class:"btn-back"},{default:x(()=>[...e[12]||(e[12]=[q(" ← Volver ",-1)])]),_:1})]),a("form",{onSubmit:Q(R,["prevent"]),class:"form"},[a("div",ie,[e[23]||(e[23]=a("h3",null,"Información Básica",-1)),a("div",le,[e[13]||(e[13]=a("label",{for:"titulo"},"Título *",-1)),s(a("input",{type:"text",id:"titulo","onUpdate:modelValue":e[0]||(e[0]=o=>t.value.titulo=o),required:"",placeholder:"Ej: Departamento Moderno en Centro"},null,512),[[c,t.value.titulo]])]),a("div",se,[e[14]||(e[14]=a("label",{for:"descripcion"},"Descripción",-1)),s(a("textarea",{id:"descripcion","onUpdate:modelValue":e[1]||(e[1]=o=>t.value.descripcion=o),rows:"4",placeholder:"Describe las características de la propiedad..."},null,512),[[c,t.value.descripcion]])]),a("div",re,[a("div",ne,[e[16]||(e[16]=a("label",{for:"tipo"},"Tipo *",-1)),s(a("select",{id:"tipo","onUpdate:modelValue":e[2]||(e[2]=o=>t.value.tipo=o),required:""},[...e[15]||(e[15]=[a("option",{value:"venta"},"Venta",-1),a("option",{value:"alquiler"},"Alquiler",-1)])],512),[[h,t.value.tipo]])]),a("div",de,[e[18]||(e[18]=a("label",{for:"divisa"},"Divisa *",-1)),s(a("select",{id:"divisa","onUpdate:modelValue":e[3]||(e[3]=o=>t.value.divisa=o),required:""},[...e[17]||(e[17]=[a("option",{value:"ARS"},"Pesos Argentinos (ARS)",-1),a("option",{value:"USD"},"Dólares (USD)",-1)])],512),[[h,t.value.divisa]])]),a("div",ue,[e[19]||(e[19]=a("label",{for:"precio"},"Precio *",-1)),s(a("input",{type:"number",id:"precio","onUpdate:modelValue":e[4]||(e[4]=o=>t.value.precio=o),required:"",step:"0.01",placeholder:"0.00"},null,512),[[c,t.value.precio,void 0,{number:!0}]])])]),a("div",pe,[e[20]||(e[20]=a("label",{for:"ubicacion"},"Ubicación *",-1)),s(a("input",{type:"text",id:"ubicacion","onUpdate:modelValue":e[5]||(e[5]=o=>t.value.ubicacion=o),required:"",placeholder:"Ej: Centro, Mendoza",onInput:G},null,544),[[c,t.value.ubicacion]])]),a("div",ce,[e[22]||(e[22]=a("label",null,"Ubicación en el Mapa",-1)),a("div",me,[a("div",{id:"map",ref_key:"mapContainer",ref:M,class:"map"},null,512),e[21]||(e[21]=a("p",{class:"hint"},"Haz clic en el mapa para marcar la ubicación exacta de la propiedad",-1))]),t.value.latitud&&t.value.longitud?(u(),d("div",ve," Coordenadas: "+f(t.value.latitud.toFixed(6))+", "+f(t.value.longitud.toFixed(6)),1)):w("",!0)])]),a("div",fe,[e[27]||(e[27]=a("h3",null,"Características",-1)),a("div",ge,[a("div",be,[e[24]||(e[24]=a("label",{for:"dormitorios"},"Dormitorios *",-1)),s(a("input",{type:"number",id:"dormitorios","onUpdate:modelValue":e[6]||(e[6]=o=>t.value.dormitorios=o),required:"",min:"0"},null,512),[[c,t.value.dormitorios,void 0,{number:!0}]])]),a("div",ye,[e[25]||(e[25]=a("label",{for:"banos"},"Baños *",-1)),s(a("input",{type:"number",id:"banos","onUpdate:modelValue":e[7]||(e[7]=o=>t.value.banos=o),required:"",min:"0"},null,512),[[c,t.value.banos,void 0,{number:!0}]])]),a("div",ke,[e[26]||(e[26]=a("label",{for:"superficie"},"Superficie (m²) *",-1)),s(a("input",{type:"number",id:"superficie","onUpdate:modelValue":e[8]||(e[8]=o=>t.value.superficie=o),required:"",step:"0.01",min:"0"},null,512),[[c,t.value.superficie,void 0,{number:!0}]])])])]),a("div",we,[e[30]||(e[30]=a("h3",null,"Opciones",-1)),a("div",Ce,[a("label",null,[s(a("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=o=>t.value.destacada=o)},null,512),[[D,t.value.destacada]]),e[28]||(e[28]=a("span",null,"Marcar como destacada",-1))])]),a("div",Ve,[a("label",null,[s(a("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=o=>t.value.activa=o)},null,512),[[D,t.value.activa]]),e[29]||(e[29]=a("span",null,"Propiedad activa (visible en el sitio)",-1))])])]),a("div",Ee,[e[32]||(e[32]=a("h3",null,"Imágenes",-1)),V.value&&g.value.length>0?(u(),d("div",Ie,[(u(!0),d(_,null,S(g.value,(o,n)=>(u(),d("div",{key:n,class:"imagen-item"},[a("img",{src:$(o),alt:`Imagen ${n+1}`},null,8,Me),a("button",{type:"button",onClick:H=>N(o,n),class:"btn-delete-img"}," × ",8,Fe)]))),128))])):w("",!0),m.value.length>0?(u(),d("div",Pe,[(u(!0),d(_,null,S(m.value,(o,n)=>(u(),d("div",{key:"preview-"+n,class:"imagen-item"},[a("img",{src:o.preview,alt:`Nueva imagen ${n+1}`},null,8,Ue),a("button",{type:"button",onClick:H=>z(n),class:"btn-delete-img"}," × ",8,xe)]))),128))])):w("",!0),a("div",he,[a("input",{type:"file",ref_key:"fileInput",ref:B,onChange:j,accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:"",style:{display:"none"}},null,544),a("button",{type:"button",onClick:e[11]||(e[11]=o=>i.$refs.fileInput.click()),class:"btn-upload"}," + Seleccionar Imágenes "),e[31]||(e[31]=a("p",{class:"hint"},"Formatos: JPG, PNG, WEBP | Máximo 5MB por imagen | Múltiples archivos",-1))])]),v.value?(u(),d("div",De,f(v.value),1)):w("",!0),a("div",_e,[U(l,{to:"/admin/propiedades",class:"btn-cancel"},{default:x(()=>[...e[33]||(e[33]=[q(" Cancelar ",-1)])]),_:1}),a("button",{type:"submit",class:"btn-save",disabled:b.value},f(b.value?"Guardando...":"Guardar Propiedad"),9,Se)])],32)])}}},$e=O(qe,[["__scopeId","data-v-e6abff66"]]);export{$e as default};
